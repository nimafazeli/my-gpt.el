#+TITLE: my-gpt: Emacs Org-mode Integration for AI Language Models
#+AUTHOR: Nima Fazeli
#+DATE: [2024-05-15 Wed]

* Introduction
  ~my-gpt~ is an Emacs package that integrates AI language models (currently OpenAI's GPT and Perplexity AI) into Org-mode. It allows you to interact with these AI services directly from your Org documents using org-babel code blocks.

* Installation
  1. Ensure you have Emacs 27.1 or later installed.
  2. Place the ~my-gpt.el~ file in your Emacs load path.
  3. Add the following to your Emacs configuration:

     #+begin_src emacs-lisp
     (require 'my-gpt)
     (add-to-list 'org-babel-load-languages '(my-gpt . t))
     (org-babel-do-load-languages 'org-babel-load-languages org-babel-load-languages)
     #+end_src

  4. Set up your API keys in the =~/.authinfo.gpg= file:

     #+begin_example
     machine api.openai.com login org-ai password YOUR_OPENAI_API_KEY
     machine api.perplexity.ai login org-ai password YOUR_PERPLEXITY_API_KEY
     #+end_example

* Basic Usage
  To use ~my-gpt~ in an Org document, create a code block with the ~my-gpt~ language:

  #+begin_src org
  ,#+begin_src my-gpt
  What is the capital of France?
  ,#+end_src
  #+end_src

  Execute the block with ~C-c C-c~, and the AI's response will appear below the block.

* Features and Advanced Usage

** Specifying the AI Service
   Use the ~:service~ header argument to choose between OpenAI and Perplexity:

   #+begin_src my-gpt :service openai
   Describe emacs in one sentence.
   #+end_src

   #+RESULTS:
   : Emacs is a highly customizable, open-source text editor that includes features for coding, project planning, and even email, making it a comprehensive tool for a wide range of tasks.





   #+begin_src my-gpt :service perplexity :results output
   What was the closing value of SPY in the past three days? Give me only an org-mode table of the results (without the backtick code guards of gfm).
   #+end_src

   #+RESULTS:
   : | Date       | Closing Value |
   : |------------|---------------|
   : | Aug 28, 2024 | 559.28        |
   : | Aug 27, 2024 | 560.65        |
   : | Aug 26, 2024 | 558.70        |
   : 
   : Note: The closing values are based on the historical price data from YCharts.



** Setting the AI Model
   Specify the model using the ~:model~ header argument:

   #+begin_src my-gpt :service openai :model gpt-4o
   Write a haiku about spacemacs.
   #+end_src

   #+RESULTS:
   : In the code's vast space,
   : Spacemacs lights the dark with ease,
   : Scripting stars in place.

   
   #+begin_src my-gpt :service perplexity :model llama-3.1-sonar-large-128k-online
   What is the current price of Bitcoin?
   #+end_src

   #+RESULTS:
   : As of August 28, 2024, the current price of Bitcoin is $59,938.50 USD.


   
** Using persistent Sessions
   Use the ~:session~ header argument to maintain context across multiple code blocks:

   #+begin_src my-gpt :service perplexity :session test :results output
   What was the closing value of SPY in the past three days? Give me only an org-mode table of the results in raw format without markdown guards and any other text explanations.
   #+end_src

   #+RESULTS:
   : | Date       | Closing Value |
   : |------------|---------------|
   : | Aug 28, 2024 | 559.28        |
   : | Aug 27, 2024 | 561.56        |
   : | Aug 26, 2024 | 560.79        |
   : 
   : [Source: YCharts and other historical data sources]


   
   #+begin_src my-gpt :service perplexity :session test :results output
   Give me a link to the chart of the data
   #+end_src

   #+RESULTS:
   : You can find the historical price chart for SPY on various financial websites. Here are some links to charts:
   : 
   : 1. **YCharts**: [SPY Price Chart](https://ycharts.com/companies/SPY/price)
   : 2. **TradingView**: [SPY Chart](https://www.tradingview.com/symbols/AMEX-SPY/)
   : 3. **Macrotrends**: [SPDR S&P 500 ETF Stock Price History](https://www.macrotrends.net/stocks/charts/SPY/spdr-s-p-500-etf/stock-price-history)
   : 
   : These links provide interactive charts that allow you to view historical price data for SPY.


** Using System directives

It is possible to give a system directive that can persist within a subtree

*** AI Conversations
:PROPERTIES:
:SYSTEM: You are a helpful assistant in haskell programming. Your provide simple, readable and transparent code. Provide concise and efficient code. When providing code, you provide code and only code. No extra prose and explanation. 
:END:

#+begin_src my-gpt :session haskell
Provide an example of using list comprehensions.
#+end_src

#+RESULTS:
: [ x * 2 | x <- [1..10], x * 2 >= 12 ]


#+begin_src my-gpt
Provide an example of using list comprehensions.
#+end_src

#+RESULTS:
: let evens = [x*2 | x <- [1..10]]


#+begin_src my-gpt :session haskell
Set the list to go up to 20 in increments of 2.
#+end_src

#+RESULTS:
: [ x * 2 | x <- [1..10], x * 2 >= 12, x `mod` 2 == 0 ]

*** Python Programming
:PROPERTIES:
:SYSTEM: You are a Python programming expert. Provide concise and efficient code. When providing code, you provide code and only code. No extra prose and explanation. 
:END:


#+begin_src my-gpt :session python
Now provide an example of using list comprehensions.
#+end_src

#+RESULTS:
: numbers = [1, 2, 3, 4, 5]
: squares = [num ** 2 for num in numbers]

   

#+begin_src my-gpt :session python
Provide another example.
#+end_src

#+RESULTS:
: names = ["John", "Anna", "Ray", "Sophie", "Mike"]
: short_names = [name for name in names if len(name) < 5]

* Conclusion
  ~my-gpt~ provides a flexible and powerful way to integrate AI language models into your Org-mode workflow. From simple queries to complex, context-aware interactions, you can leverage the power of AI directly within your documents.

  For more information or to report issues, please visit the project repository at =github.com/nimafazeli/my-gpt.el=

  Happy AI-assisted note-taking and writing!
